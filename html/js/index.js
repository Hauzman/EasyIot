const endpoint={baseUrl:""};var config,source=null;function removeFromSelect(e,t){$("#"+e+" option[value='"+t+"']").remove()}function addToSelect(e,t,o){let a=document.getElementById(e);if(a){removeFromSelect(e,o);let n=document.createElement("option");n.appendChild(document.createTextNode("")),n.value=o,a.appendChild(n),$("#"+e+" option[value='"+o+"']").addClass(t)}}function requestUpdate(){$.ajax({url:endpoint.baseUrl+"/auto-update",contentType:"text/plain; charset=utf-8",success:function(e){showMessage("O Dispositivo vai iniciar a atualização automática, aguarde.","The device started the auto upgrade.")},error:function(){showMessage("Não foi possivel iniciar a atualização automárica, tenta novamente.","Can't be possible to start auto update, retry again.")},timeout:1e3})}function buildSwitchTemplate(){if($("#bs_NEW").length>0)return;buildSwitch({id:"NEW",name:"Novo Interruptor",family:"switch",primaryGpio:99,secondaryGpio:99,upCourseTime:25,downCourseTime:25,autoStateDelay:0,autoStateValue:"",typeControl:2,mode:1,knxLevelOne:0,knxLevelTwo:0,knxLevelThree:0,pullup:!1,mqttRetain:!1,inverted:!1,mqttCommandTopic:"../set",mqttStateTopic:"../state",mqttPositionCommandTopic:"../setposition",mqttPositionStateTopic:"../position",primaryGpioControl:99,secondaryGpioControl:99})}function buildSensorTemplate(){if($("#bss_NEW").length>0)return;buildSensor({id:"NEW",name:"Novo Sensor",primaryGpio:99,type:65,knxLevelOne:0,knxLevelTwo:0,knxLevelThree:0,mqttRetain:!0,mqttStateTopic:"../state",delayRead:2e3})}function setOptionOnSelect(e,t){let o=document.getElementById(e);o&&(o.selectedIndex=$("#"+e+" option[value='"+t+"']").index())}function show(e){$("#"+e).removeClass("hide")}function hide(e){$("#"+e).addClass("hide")}var WORDS_EN={"pin-state-a":"Pin State A",gate:"Gate","pin-state-b":"Pin State B","pin-out-3":"Output Pin C","update-from-server":"NEW UPGRADE",node:"NODE",up:"Up",down:"Down","reading-interval":"Readings every",sensors:"Sensors",integrations:"INTEGRATIONS",update:"UPDATE",features:"FEATURES","current-version":"Current version","new-file":"Choose new version file","install-new-version":"Auto Upgrade to version","install-file-version":"Install file version",version:"Version",save:"Save","clean-fields":"Clear all Fields",username:"Username",password:"Password",yes:"Yes",no:"No",netmask:"Netmask",system:"System",name:"Name",restart:"Restart",seconds:"seconds",in:"in","reset-factory":"Load Factory Defaults",switches:"Switches",remove:"Remove",new:"New",family:"Family",switch:"Switch",light:"Light",cover:"Cover",lock:"Lock",released:"Released",disconnected:"disconnected",dconnected:"connected",integrate:"Integrate",normal:"Generic",choose:"select",push:"Push","dual-push":"Dual Push","dual-normal":"Dual Generic",mode:"Mode","relay-mqtt":"Relay / MQTT",control:"Output","pin-in-a":"Input Pin a","pin-in-b":"Input Pin b","pin-out-1":"Output Pin a","pin-out-2":"Output Pin b",none:"None","retain-message":"Retain Messages",command:"Command",state:"State",on:"On","auto-state":"Auto State",off:"Off",locked:"Lock",unlock:"Unlocked",open:"Open",close:"Closed",mqtt:"MQTT",stop:"Stop",time:"Time",17:"A0",group:"Group","pin-in-c":"Input Pin c",line:"Line",member:"Member",address:"Address",prefix:"Prefix",apikey:"API Key"},WORDS_PT={gate:"Portão","pin-state-a":"Pino Estadp A","pin-state-b":"Pino Estado B","pin-out-3":"Pino saída c","update-from-server":"NOVA ATUALIZAÇÃO",node:"NÓ",up:"Subida",down:"Descida",group:"Grupo",integrations:"INTEGRAÇÕES",sensors:"Sensores",integrate:"Integrar",released:"Libertar","reading-interval":"Leituras a cada",update:"ATUALIZAR",features:"FUNÇÕES","current-version":"Versão atual","new-file":"Escolher o ficheiro da nova versão","install-new-version":"Atualizar automáticamente para a versão ","install-file-version":"Instalar versão do ficheiro",version:"Versão",save:"Guardar",choose:"escolher","auto-state":"Estádo automático","clean-fields":"Limpar todos os campos",username:"Utilizador",password:"Palavra Passe",yes:"Sim",no:"Não",disconnected:"desligado",dconnected:"ligado",netmask:"Máscara de Rede",system:"Sistema",name:"Nome",in:"em",seconds:"segundos",restart:"Reiniciar","reset-factory":"Carregar Configuração de Fábrica",switches:"Interruptores",remove:"Remover",new:"Criar Novo",family:"Familia",switch:"Interruptor",light:"Luz",cover:"Estore",lock:"Fechadura",normal:"Normal",push:"Pressão","dual-push":"Duplo Pressão","dual-normal":"Duplo Normal",mode:"Modo","relay-mqtt":"Relé / MQTT",mqtt:"MQTT",control:"Saída","pin-in-a":"Pino Entrada a","pin-in-b":"Pino Entrada b","pin-in-c":"Pino Entrada c","pin-out-1":"Pino Saída a","pin-out-2":"Pino Saída b",none:"Não atribuido","retain-message":"Reter Mensagens",command:"Comando",state:"Estado",on:"Ligado",off:"Desligado",locked:"Trancado",unlock:"Destrancado",open:"Aberto",close:"Fechado",stop:"Parar",time:"Tempo",17:"A0",line:"Linha",member:"Membro",address:"Endereço",prefix:"Prefixo",apikey:"Chave da API"};function loadsLanguage(e){null===e&&(e=window.navigator.language.startsWith("en")?"EN":"PT"),localStorage.setItem("lang",e),$('span[class^="lang"]').each(function(){var t=this.className.replace("lang-",""),o=window["WORDS_"+e][t];$(this).text(o)}),$('option[class^="lang"]').each(function(){var t=this.className.replace("lang-",""),o=window["WORDS_"+e][t];o||(o=t),$(this).text(o)})}function showMessage(e,t){"PT"===localStorage.getItem("lang").toString()?alert(e):alert(t)}function showText(e,t){return"PT"===localStorage.getItem("lang").toString()?e:t}function loadConfig(){const e=endpoint.baseUrl+"/config";$.ajax({url:e,contentType:"text/plain; charset=utf-8",dataType:"json",success:function(e){config=e,fillConfig()},error:function(){showMessage("Erro a carregar configuração","Configuration load failed.")},complete:function(){},timeout:2e3})}function loadDevice(e,t,o){const a=endpoint.baseUrl+"/"+t;$.ajax({url:a,contentType:"application/json",dataType:"json",success:function(t){e(t),o&&o()},error:function(){showMessage("Erro a carregar configuração de funcionalidades.","Features Configuration load failed.")},timeout:2e3})}function fillConfig(){if(!config)return;$(".bh-model").text(config.hardware),$(".bh-onofre-item").removeClass("hide"),$("#version_lbl").text(config.firmware),$("#lbl-chip").text(config.chipId),$("#lbl-mac").text(config.mac),$('input[name="nodeId"]').val(config.nodeId),$(document).prop("title","BH OnOfre "+config.nodeId),$('input[name="mqttIpDns"]').val(config.mqttIpDns),$("#mqtt_lbl").text(config.mqttIpDns),$('input[name="mqttUsername"]').val(config.mqttUsername),$('input[name="mqttPassword"]').val(config.mqttPassword),$('input[name="wifiSSID"]').val(config.wifiSSID),$('input[name="wifiSecret"]').val(config.wifiSecret),$('input[name="knxArea"]').val(config.knxArea),$('input[name="knxMember"]').val(config.knxMember),$('input[name="knxLine"]').val(config.knxLine);let e=document.getElementById("staticIp");e&&(e.checked=!config.staticIp),$('input[name="wifiIp"]').val(config.wifiIp),$('input[name="wifiMask"]').val(config.wifiMask),$('input[name="wifiGw"]').val(config.wifiGw),$('input[name="apSecret"]').val(config.apSecret),$('input[name="emoncmsServer"]').val(config.emoncmsServer),$('input[name="emoncmsPath"]').val(config.emoncmsPath),$('input[name="emoncmsApikey"]').val(config.emoncmsApikey),getLastVersion(config.firmwareMode,config.firmware,config.chipId),$("#ff").prop("disabled",!1)}function toggleActive(e){$(".sidebar-menu").find("li").removeClass("active"),$('.menu-item[data-menu="'+e+'"]').closest("li").addClass("active"),$(".content").load(e+".html?7.99",function(){"devices"===e?loadDevice(fillSwitches,"switches",function(){loadDevice(fillSensors,"sensors",function(){})}):(systemStatus(),fillConfig()),loadsLanguage(localStorage.getItem("lang"))})}function fillSwitches(e){if(e){$("#switch_config").empty();for(let t of e)buildSwitch(t)}}function fillSensors(e){if(e){$("#sensors_config").empty();for(let t of e)buildSensor(t),source.addEventListener(t.id,function(e){updateSensorReadings(t.id,t.name,e.data)},!1)}}function applySwitchFamily(e){hide("timeBetweenStatesRow_"+e),hide("secondaryGpioControlRow_"+e),hide("secondaryGpioRow_"+e),hide("btn_on_"+e),hide("btn_close_"+e),hide("btn_stop_"+e),hide("btn_open_"+e),removeFromSelect("mode_"+e,1),removeFromSelect("mode_"+e,2),removeFromSelect("mode_"+e,4),removeFromSelect("mode_"+e,5),removeFromSelect("mode_"+e,6),removeFromSelect("autoStateValue_"+e,"OPEN"),removeFromSelect("autoStateValue_"+e,"CLOSE"),removeFromSelect("autoStateValue_"+e,"STOP"),removeFromSelect("autoStateValue_"+e,"ON"),removeFromSelect("autoStateValue_"+e,"OFF"),removeFromSelect("autoStateValue_"+e,"UNLOCK"),removeFromSelect("autoStateValue_"+e,"LOCK"),"cover"==$("#family_"+e).val()?(show("btn_close_"+e),show("btn_stop_"+e),show("btn_open_"+e),addToSelect("mode_"+e,"lang-push",2),addToSelect("mode_"+e,"lang-dual-normal",4),addToSelect("mode_"+e,"lang-dual-push",5),addToSelect("mode_"+e,"lang-gate",6),show("secondaryGpioControlRow_"+e),show("secondaryGpioRow_"+e),show("timeBetweenStatesRow_"+e),addToSelect("autoStateValue_"+e,"lang-open","OPEN"),addToSelect("autoStateValue_"+e,"lang-close","CLOSE"),addToSelect("autoStateValue_"+e,"lang-stop","STOP")):"lock"==$("#family_"+e).val()?(show("btn_on_"+e),addToSelect("mode_"+e,"lang-push",2),addToSelect("mode_"+e,"lang-gate",6),addToSelect("autoStateValue_"+e,"lang-released","RELEASED")):(show("btn_on_"+e),addToSelect("mode_"+e,"lang-normal",1),addToSelect("mode_"+e,"lang-push",2),addToSelect("autoStateValue_"+e,"lang-on","ON"),addToSelect("autoStateValue_"+e,"lang-off","OFF")),applySwitchMode(e),applyTypeControl(e),loadsLanguage(localStorage.getItem("lang"))}function fillGpioSelect(e){addToSelect(e,"lang-none",99);for(let t of["17","0","1","2","3","4","5","12","13","14","15","16"])addToSelect(e,"lang-"+t,t)}function applySwitchMode(e){"cover"==$("#family_"+e).val()?(2==$("#mode_"+e).val()?(setOptionOnSelect("secondaryGpio_"+e,99),hide("secondaryGpioRow_"+e)):show("secondaryGpioRow_"+e),show("secondaryGpioControlRow_"+e)):"lock"==$("#family_"+e).val()&&show("secondaryGpioControlRow_"+e),loadsLanguage(localStorage.getItem("lang"))}function ifdef(e,t){return e||t}function applyTypeControl(e){hide("secondaryGpioControlRow_"+e),hide("primaryGpioControlRow_"+e),1==$("#typeControl_"+e).val()?(show("primaryGpioControlRow_"+e),"cover"==$("#family_"+e).val()&&2!=$("#mode_"+e).val()&&show("secondaryGpioControlRow_"+e)):(setOptionOnSelect("primaryGpioControl_"+e,99),setOptionOnSelect("secondaryGpioControl_"+e,99),hide("secondaryGpioControlRow_"+e),hide("primaryGpioControlRow_"+e)),6==$("#mode_"+e).val()&&show("secondaryGpioControlRow_"+e)}function applySensorRequiredGpio(e){"70"!=$("#s_type_"+e).val()&&"71"!=$("#s_type_"+e).val()?(hide("s_secondaryGpioRow_"+e),hide("s_tertiaryGpioRow_"+e),setOptionOnSelect("s_secondaryGpio_"+e,99),setOptionOnSelect("s_tertiaryGpio_"+e,99)):(show("s_secondaryGpioRow_"+e),show("s_tertiaryGpioRow_"+e))}function buildSensor(e){let t=e.mqttRetain?"checked":"",o=e.haSupport?"checked":"",a=e.emoncmsSupport?"checked":"",n=e.mqttSupport?"checked":"",i=e.cloudIOSupport?"checked":"";$("#sensors_config").append('<div id="bss_'+e.id+'" style="padding: 0; margin: 10px;" class="col-lg-4 col-md-6 col-xs-12">                <div style="margin-bottom: 0" class="info-box bg-aqua">                    <div class="info-box-content"><span class="info-box-text">'+e.name+'</span>                        <div class="pull-right"><span id="value_'+e.id+'"></span>                        </div>                    </div>                </div>                <div style="font-size: 10px;  border: 0 solid #08c; border-radius: 0" class="box">                    <div class="box-body no-padding">                        <table class="table table-condensed">                            <tbody>                            <tr style="  border-top: 1px solid #88bf9c;">                                <td><span class="label-device "><span                                    class="lang-sensor">Sensor</span></span></td>                                <td><select onchange="applySensorRequiredGpio(\''+e.id+'\');" class="form-control select-device" id="s_type_'+e.id+'">                                    <option value="65">PIR</option>                                    <option value="66">RCWL-0516</option>                                    <option value="21">LDR</option>                                    <option value="90">DS18B20</option>                                    <option value="56">REED SWITCH NC</option>                                    <option value="57">REED SWITCH NO</option>                                    <option value="0">DHT 11</option>                                    <option value="1">DHT 21</option>                                    <option value="2">DHT 22</option>                                    <option value="70">PZEM 004T V2</option>                                    <option value="71">PZEM 004T V3</option>                                </select></td>                            <tr>                            <tr>                                <td><span class="label-device"><span                                    class="lang-name">NOME</span></span></td>                                <td class="col-xs-8"><input class="input-device form-control" value="'+e.name+'"                                                            type="text" id="s_name_'+e.id+'" placeholder="ex: sala"                                                            maxlength="30" required/>                                </td>                            </tr>                            <tr style="  border-top: 1px solid #88bf9c;">                                <td><span class="label-device "><span                                    class="lang-pin-in-a">Pino Entrada A</span></span></td>                                <td><select class="form-control select-device" id="s_primaryGpio_'+e.id+'">                                </select></td>                            <tr>                            <tr id="s_secondaryGpioRow_'+e.id+'"">                                <td><span class="label-device "><span                                    class="lang-pin-in-b">Pino Entrada B</span></span></td>                                <td><select class="form-control select-device" id="s_secondaryGpio_'+e.id+'">                                </select></td>                            <tr>                            <tr id="s_tertiaryGpioRow_'+e.id+'"">                                <td><span class="label-device "><span                                    class="lang-pin-in-c">Pino Entrada C</span></span></td>                                <td><select class="form-control select-device" id="s_tertiaryGpio_'+e.id+'">                                </select></td>                            <tr>                                <td><span class="label-device" style="color: #88bf9c; font-size: 13px;">MQTT</span></td>                            </tr>                            <tr>                                <td><span class="label-device-indent"><span class="lang-state">Estado</span></span></td>                                <td><span  style="word-break: break-word">'+e.mqttStateTopic+'</span></td>                            </tr>                            <tr>                                <td style="vertical-align: middle"><span class="label-device-indent label-device"><span class="lang-retain-message">Reter Mensagens</span></span></td>                                <td><input class="form-control" style="width: 20px; height: 20px;" '+t+' type="checkbox" id="s_mqttRetain_'+e.id+'" value="'+e.mqttRetain+'"></td>                            </tr>                            <tr >                                <td><span class="label-device"><span                                    class="lang-reading-interval">Leituras a cada </span></span></td>                                <td class="col-xs-8"><input style="float: left; width: 70%;" class="input-device form-control" value="'+e.delayRead/1e3+'"                                                            type="text" id="s_delayRead_'+e.id+'" placeholder="ex: 12"                                                             maxlength="2" required/><span style=" margin-left:10px; float: left;"                                     class="lang-seconds">Segundos</span>                                 </td>                            </tr>                            <tr>                                <td style="vertical-align: middle"><span class="label-device"><span class="lang-integrate">Integrar</span></span></td>                                <td style="display: inline-flex">                                       <span style="padding: 6px; color: #4ca2cd; font-weight: 600" >Home Assistant</span><input class="form-control" style="width: 20px; height: 20px; margin-right: 10px;" '+o+' type="checkbox" id="s_haSupport_'+e.id+'" value="'+e.haSupport+'">                                       <span style="padding: 6px; color: #4ca2cd; font-weight: 600" >Emoncms</span><input class="form-control" style="width: 20px; height: 20px;" '+a+' type="checkbox" id="s_emoncmsSupport_'+e.id+'" value="'+e.emoncmsSupport+'">                                       <span style="padding: 6px; color: #4ca2cd; font-weight: 600" >MQTT</span><input class="form-control" style="width: 20px; height: 20px;" '+n+' type="checkbox" id="s_mqttSupport_'+e.id+'" value="'+e.mqttSupport+'">                                       <span style="padding: 6px; color: #4ca2cd; font-weight: 600" >CloudIO</span><input class="form-control" style="width: 20px; height: 20px;" '+i+' type="checkbox" id="s_cloudIOSupport_'+e.id+'" value="'+e.cloudIOSupport+'">                               </td>                            </tr>                            </tbody>                        </table>                        <div class="box-footer save">                            <button onclick="removeSensor(\''+e.id+'\')" style="font-size: 12px" class="btn btn-danger"><span                                class="lang-remove">Remover</span></button>                            <button  onclick="saveSensor(\''+e.id+'\')" style="font-size: 12px" class="btn btn-primary"><span                                class="lang-save">Guardar</span></button>                        </div>                    </div>                </div>            </div>'),fillGpioSelect("s_primaryGpio_"+e.id),fillGpioSelect("s_secondaryGpio_"+e.id),fillGpioSelect("s_tertiaryGpio_"+e.id),setOptionOnSelect("s_primaryGpio_"+e.id,e.primaryGpio),setOptionOnSelect("s_secondaryGpio_"+e.id,e.secondaryGpio),setOptionOnSelect("s_tertiaryGpio_"+e.id,e.tertiaryGpio),setOptionOnSelect("s_type_"+e.id,e.type),applySensorRequiredGpio(e.id),loadsLanguage(localStorage.getItem("lang"))}function updateSensorReadings(e,t,o){$("#value_"+e).length>0&&$("#value_"+e).text(o)}function buildSwitch(e){let t="ON"===e.stateControl?" "+e.stateControl+" ":"OFF",o="OPEN"===e.stateControl?" "+e.stateControl+" ":"",a="CLOSE"===e.stateControl?" "+e.stateControl+" ":"",n=e.mqttSupport?"checked":"",i=e.haSupport?"checked":"",s=e.cloudIOSupport?"checked":"",l=e.knxSupport?"checked":"";source.addEventListener(e.id,function(t){let o="OFF"===t.data||"ON"===t.data?"on":t.data.toLowerCase();$("#btn_"+o+"_"+e.id).removeClass("ON"),$("#btn_"+o+"_"+e.id).removeClass("OPEN"),$("#btn_"+o+"_"+e.id).removeClass("CLOSE"),$("#btn_"+o+"_"+e.id).addClass(t.data)},!1),$("#switch_config").append('<div id="bs_'+e.id+'" style="padding: 0; margin: 10px;" class="col-lg-4 col-md-6 col-xs-12">                <div style="margin-bottom: 0" class="info-box bg-aqua">                    <div class="info-box-content"><span class="info-box-text">'+e.name+'</span>                        <div class="pull-right">                            <button onclick="stateSwitch(\''+e.id+"','OPEN')\" id=\"btn_open_"+e.id+'" class="'+o+' btn btn-primary btn-control">                                <svg width="24" height="24" viewBox="0 0 24 24">                                    <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"/>                                    <path d="M0 0h24v24H0z" fill="none"/>                                </svg>                            </button>                            <button onclick="stateSwitch(\''+e.id+"','STOP')\" id=\"btn_stop_"+e.id+'" class=" btn btn-primary btn-control">                                <svg width="24" height="24" viewBox="0 0 24 24">                                    <path d="M0 0h24v24H0z" fill="none"/>                                    <path d="M6 6h12v12H6z"/>                                </svg>                            </button>                            <button onclick="stateSwitch(\''+e.id+"','CLOSE')\" id=\"btn_close_"+e.id+'" class="'+a+' btn btn-primary btn-control">                                <svg width="24" height="24" viewBox="0 0 24 24">                                    <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"/>                                    <path d="M0 0h24v24H0z" fill="none"/>                                </svg>                            </button>                            <button onclick="rotateState(\''+e.id+'\')" id="btn_on_'+e.id+'" class="'+t+' btn btn-primary btn-control">                                <svg style="width:24px;height:24px" viewBox="0 0 24 24">                                    <path fill="#000000" d="M11,3H13V21H11V3Z"/>                                </svg>                            </button>                        </div>                    </div>                </div>                <div style="font-size: 10px;  border: 0 solid #08c; border-radius: 0" class="box">                    <div class="box-body no-padding">                        <table class="table table-condensed">                            <tbody>                            <tr>                                <td><span class="label-device"><span                                    class="lang-name">NOME</span></span></td>                                <td class="col-xs-8"><input class="input-device form-control" value="'+e.name+'"                                                            type="text" id="name_'+e.id+'" placeholder="ex: luz sala"                                                            maxlength="30" required/>                                </td>                            </tr>                            <tr>                                <td><span class="label-device "><span                                    class="lang-family">FAMILIA</span></span></td>                                <td><select onchange="applySwitchFamily(\''+e.id+'\');" class="form-control select-device" id="family_'+e.id+'">                                    <option class="lang-switch" value="switch">Interruptor</option>                                    <option class="lang-light" value="light">Luz</option>                                    <option class="lang-cover" value="cover">Estore</option>                                    <option class="lang-lock" value="lock">Fechadura</option>                                </select></td>                            </tr>                            <tr>                                <td><span class="label-device "><span                                    class="lang-mode">MODO</span></span></td>                                <td><select onchange="applySwitchMode(\''+e.id+'\');" class="form-control select-device" id="mode_'+e.id+'">                                </select></td>                            </tr>                            <tr>                                <td><span class="label-device "><span                                    class="lang-control">Controla</span></span></td>                                <td><select onchange="applyTypeControl(\''+e.id+'\');" class="form-control select-device" id="typeControl_'+e.id+'">                                    <option class="lang-relay-mqtt" value="1">Relé / MQTT</option>                                    <option class="lang-mqtt" value="2">MQTT</option>                                </select></td>                            </tr>                            <tr style="  border-top: 1px solid #88bf9c;">                                <td><span class="label-device "><span                                    class="lang-pin-in-a">Pino Entrada A</span></span></td>                                <td><select class="form-control select-device" id="primaryGpio_'+e.id+'">                                </select></td>                            </tr>                            <tr id="secondaryGpioRow_'+e.id+'"">                                <td><span class="label-device"><span                                    class="lang-pin-in-b">Pino Entrada B</span></span></td>                                <td><select class="form-control select-device" id="secondaryGpio_'+e.id+'">                                </select></td>                            </tr>                            <tr id="primaryStateGpioRow_'+e.id+'"">                                <td><span class="label-device"><span                                    class="lang-pin-state-a">Pino Estado A</span></span></td>                                <td><select class="form-control select-device" id="primaryStateGpio_'+e.id+'">                                </select></td>                            </tr>                            <tr id="secondaryStateGpioRow_'+e.id+'"">                                <td><span class="label-device"><span                                    class="lang-pin-state-b">Pino Estado B</span></span></td>                                <td><select class="form-control select-device" id="secondaryStateGpio_'+e.id+'">                                </select></td>                            </tr>                            <tr id="primaryGpioControlRow_'+e.id+'" style="  border-top: 1px solid #d9534f;">                                <td><span class="label-device "><span                                    class="lang-pin-out-1">Pino Saida 1</span></span></td>                                <td><select class="form-control select-device" id="primaryGpioControl_'+e.id+'">                            </tr>                            <tr id="secondaryGpioControlRow_'+e.id+'" ">                                <td><span class="label-device "><span                                    class="lang-pin-out-2">Pino Saida 2</span></span></td>                                <td><select class="form-control select-device" id="secondaryGpioControl_'+e.id+'">                                </select></td>                            </tr>                            <tr id="thirdGpioControlRow_'+e.id+'" ">                                <td><span class="label-device "><span                                    class="lang-pin-out-3">Pino Saida 3</span></span></td>                                <td><select class="form-control select-device" id="thirdGpioControl_'+e.id+'">                                </select></td>                            </tr>                            <tr>                                <td><span class="label-device" style="color: #88bf9c; font-size: 13px;">MQTT</span></td>                            </tr>                            <tr>                                <td><span class="label-device-indent"><span class="lang-command">Comando</span></span></td>                                <td> <span style="word-break: break-word" >'+e.mqttCommandTopic+'</span></td>                            </tr>                            <tr>                                <td><span class="label-device-indent"><span class="lang-state">Estado</span></span></td>                                <td><span  style="word-break: break-word">'+e.mqttStateTopic+'</span></td>                            </tr>                            <tr>                                <td><span class="label-device" style="color: dodgerblue; font-size: 13px;">KNX</span></td>                            </tr>                            <tr>                                <td><span class="label-device-indent"><span                                    class="lang-group">Grupo</span></span></td>                                <td class="col-xs-8"><input style="width: 50px; float: left; margin-left: 5px;" class="input-device form-control" value="'+e.knxLevelOne+'"                                                            type="text" id="knxLevelOne_'+e.id+'" placeholder="ex: 2"                                                             maxlength="2" required/><input style="width: 50px; float: left; margin-left: 5px;" class="input-device form-control" value="'+e.knxLevelTwo+'"                                                            type="text" id="knxLevelTwo_'+e.id+'" placeholder="ex: 1"                                                             maxlength="2" required/><input style="width: 50px; float: left; margin-left: 5px;" class="input-device form-control" value="'+e.knxLevelThree+'"                                                            type="text" id="knxLevelThree_'+e.id+'" placeholder="ex: 1"                                                             maxlength="2" required/>                                </td>                            </tr>                            <tr id="timeBetweenStatesRow_'+e.id+'" >                                <td><span class="label-device"><span                                    class="lang-time">TEMPO Subida/Descida</span></span></td>                                <td class="col-xs-4"><span style="float: left" class="lang-up">Subida</span><input style="width: 50px; float: left; margin-left: 5px;" class="input-device form-control" value="'+e.upCourseTime/1e3+'"                                                            type="text" id="upCourseTime_'+e.id+'" placeholder="ex: 12"                                                             maxlength="2" required/><span style="float: left; margin-left: 10px" class="lang-down">Descida</span><input style="width: 50px; float: left; margin-left: 5px;" class="input-device form-control" value="'+e.downCourseTime/1e3+'"                                                            type="text" id="downCourseTime_'+e.id+'" placeholder="ex: 12"                                                             maxlength="2" required/><span style="float: left;margin-right: 5px" class="lang-seconds">segundos</span>                                </td>                            </tr>                            <tr>                                <td><span class="label-device"><span                                    class="lang-auto-state">Estádo automático</span></span></td>                                <td class="col-xs-8"><span style="float: left" class="lang-in">em</span><input style="width: 50px; float: left; margin-left: 5px;" class="input-device form-control" value="'+e.autoStateDelay/1e3+'"                                                            type="text" id="autoStateDelay_'+e.id+'" placeholder="ex: 12"                                                             maxlength="4" required/><span style="float: left; margin-left: 5px;" class="lang-seconds">segundos</span>                                 <select class="form-control select-device" style="float: left; width: 100px; margin-left: 5px;" id="autoStateValue_'+e.id+'">                                    <option class="lang-choose" value="">Escolha</option>                                </select>                                </td>                            </tr>                            <tr>                                <td style="vertical-align: middle"><span class="label-device"><span class="lang-integrate">Integrar</span></span></td>                                <td style="display: inline-flex">                                       <span style="padding: 6px; color: #4ca2cd; font-weight: 600" >KNX</span><input class="form-control" style="width: 20px; height: 20px; margin-right: 10px;" '+l+' type="checkbox" id="knxSupport_'+e.id+'" value="'+e.knxSupport+'">                                       <span style="padding: 6px; color: #4ca2cd; font-weight: 600" >Home Assistant</span><input class="form-control" style="width: 20px; height: 20px; margin-right: 10px;" '+i+' type="checkbox" id="haSupport_'+e.id+'" value="'+e.haSupport+'">                                       <span style="padding: 6px; color: #4ca2cd; font-weight: 600" >MQTT</span><input class="form-control" style="width: 20px; height: 20px; margin-right: 10px;" '+n+' type="checkbox" id="mqttSupport_'+e.id+'" value="'+e.mqttSupport+'">                                       <span style="padding: 6px; color: #4ca2cd; font-weight: 600" >CloudIO</span><input class="form-control" style="width: 20px; height: 20px;" '+s+' type="checkbox" id="cloudIOSupport_'+e.id+'" value="'+e.cloudIOSupport+'">                               </td>                            </tr>                            </tbody>                        </table>                        <div class="box-footer save">                            <button onclick="removeSwitch(\''+e.id+'\')" style="font-size: 12px" class="btn btn-danger"><span                                class="lang-remove">Remover</span></button>                            <button  onclick="saveSwitch(\''+e.id+'\')" style="font-size: 12px" class="btn btn-primary"><span                                class="lang-save">Guardar</span></button>                        </div>                    </div>                </div>            </div>'),"cover"===e.family?removeFromSelect("mode_"+e.id,1):(removeFromSelect("mode_"+e.id,4),removeFromSelect("mode_"+e.id,5)),fillGpioSelect("primaryGpio_"+e.id),fillGpioSelect("secondaryGpio_"+e.id),fillGpioSelect("primaryStateGpio_"+e.id),fillGpioSelect("secondaryStateGpio_"+e.id),fillGpioSelect("secondaryGpioControl_"+e.id),fillGpioSelect("primaryGpioControl_"+e.id),fillGpioSelect("secondaryGpioControl_"+e.id),fillGpioSelect("thirdGpioControl_"+e.id),setOptionOnSelect("family_"+e.id,e.family),applySwitchFamily(e.id),setOptionOnSelect("typeControl_"+e.id,e.typeControl),setOptionOnSelect("mode_"+e.id,e.mode),applySwitchMode(e.id),applyTypeControl(e.id),setOptionOnSelect("primaryGpioControl_"+e.id,e.primaryGpioControl),setOptionOnSelect("secondaryGpioControl_"+e.id,e.secondaryGpioControl),setOptionOnSelect("thirdGpioControl_"+e.id,e.thirdGpioControl),setOptionOnSelect("primaryGpio_"+e.id,e.primaryGpio),setOptionOnSelect("secondaryGpio_"+e.id,e.secondaryGpio),setOptionOnSelect("primaryStateGpio_"+e.id,e.primaryStateGpio),setOptionOnSelect("secondaryStateGpio_"+e.id,e.secondaryStateGpio),setOptionOnSelect("autoStateValue_"+e.id,e.autoStateValue),loadsLanguage(localStorage.getItem("lang"))}function stateSwitch(e,t){let o=t;"ON"!==o&&"OFF"!==o||!$("#btn_on_"+e).hasClass("ON")&&!$("#btn_on_"+e).hasClass("OFF")||(o=$("#btn_on_"+e).hasClass("ON")?"OFF":"ON"),"RELEASED"===o&&(o="LOCK");const a=endpoint.baseUrl+"/state-switch?state="+o+"&id="+e;$.ajax({type:"GET",url:a,contentType:"text/plain; charset=utf-8",dataType:"json",success:function(e){},error:function(){},complete:function(){},timeout:2e3})}function rotateState(e){const t=endpoint.baseUrl+"/rotate-state-switch?id="+e;$.ajax({type:"GET",url:t,contentType:"text/plain; charset=utf-8",dataType:"json",success:function(e){},error:function(){},complete:function(){},timeout:2e3})}function saveSensor(e){let t={id:e,name:$("#s_name_"+e).val(),primaryGpio:parseInt($("#s_primaryGpio_"+e).val()),secondaryGpio:parseInt($("#s_secondaryGpio_"+e).val()),tertiaryGpio:parseInt($("#s_tertiaryGpio_"+e).val()),type:parseInt($("#s_type_"+e).val()),knxLevelOne:parseInt($("#s_knxLevelOne_"+e).val()),knxLevelTwo:parseInt($("#s_knxLevelTwo_"+e).val()),knxLevelThree:parseInt($("#s_knxLevelThree_"+e).val()),mqttRetain:document.getElementById("s_mqttRetain_"+e).checked,haSupport:document.getElementById("s_haSupport_"+e).checked,emoncmsSupport:document.getElementById("s_emoncmsSupport_"+e).checked,mqttSupport:document.getElementById("s_mqttSupport_"+e).checked,cloudIOSupport:document.getElementById("s_cloudIOSupport_"+e).checked,delayRead:1e3*parseInt($("#s_delayRead_"+e).val())};const o=endpoint.baseUrl+"/save-sensor?id="+t.id;$.ajax({type:"POST",url:o,dataType:"json",contentType:"application/json",data:JSON.stringify(t),success:function(e){fillSensors(e),showMessage("Configuração Guardada","Config Stored")},error:function(){showMessage("Não foi possivel guardar a configuração atual, por favor tenta novamente.","Unable to save current configuration, please try again.")},complete:function(){},timeout:2e3})}function saveSwitch(e){let t={id:e,name:$("#name_"+e).val(),family:$("#family_"+e).val(),primaryGpio:parseInt($("#primaryGpio_"+e).val()),secondaryGpio:parseInt($("#secondaryGpio_"+e).val()),primaryStateGpio:parseInt($("#primaryStateGpio_"+e).val()),secondaryStateGpio:parseInt($("#secondaryStateGpio_"+e).val()),thirdGpioControl:parseInt($("#thirdGpioControl_"+e).val()),upCourseTime:1e3*parseInt($("#upCourseTime_"+e).val()),downCourseTime:1e3*parseInt($("#downCourseTime_"+e).val()),autoStateValue:$("#autoStateValue_"+e).val(),autoStateDelay:1e3*parseInt($("#autoStateDelay_"+e).val()),typeControl:parseInt($("#typeControl_"+e).val()),mode:parseInt($("#mode_"+e).val()),knxLevelOne:parseInt($("#knxLevelOne_"+e).val()),knxLevelTwo:parseInt($("#knxLevelTwo_"+e).val()),knxLevelThree:parseInt($("#knxLevelThree_"+e).val()),pullup:!0,mqttRetain:!1,haSupport:document.getElementById("haSupport_"+e).checked,cloudIOSupport:document.getElementById("cloudIOSupport_"+e).checked,knxSupport:document.getElementById("knxSupport_"+e).checked,mqttSupport:document.getElementById("mqttSupport_"+e).checked,inverted:!1,primaryGpioControl:parseInt($("#primaryGpioControl_"+e).val()),secondaryGpioControl:parseInt($("#secondaryGpioControl_"+e).val())};const o=endpoint.baseUrl+"/save-switch?id="+t.id;$.ajax({type:"POST",url:o,dataType:"json",contentType:"application/json",data:JSON.stringify(t),success:function(e){loadDevice(fillSwitches,"switches"),showMessage("Configuração Guardada","Config Stored")},error:function(){showMessage("Não foi possivel guardar a configuração atual, por favor tenta novamente.","Unable to save current configuration, please try again.")},complete:function(){},timeout:2e3})}function storeConfig(){const e=endpoint.baseUrl+"/save-config";$.ajax({type:"POST",url:e,dataType:"json",contentType:"application/json",data:JSON.stringify(config),success:function(e){config=e,fillConfig(),showMessage("Configuração Guardada","Config Stored")},error:function(){showMessage("Não foi possivel guardar a configuração atual, por favor tenta novamente.","Unable to save current configuration, please try again.")},timeout:2e3})}function saveNode(){config.nodeId=$("#nodeId").val().trim(),storeConfig()}function saveWifi(){config.wifiSSID=$("#ssid").val().trim(),config.wifiSecret=$("#wifi_secret").val().trim(),config.wifiIp=$("#wifiIp").val().trim(),config.wifiMask=$("#wifiMask").val().trim(),config.wifiGw=$("#wifiGw").val().trim(),config.staticIp=!document.getElementById("staticIp").checked,config.apSecret=$("#apSecret").val().trim(),storeConfig()}function saveMqtt(){config.mqttIpDns=$("#mqtt_ip").val().trim(),config.mqttUsername=$("#mqtt_username").val().trim(),config.mqttPassword=$("#mqtt_password").val().trim(),storeConfig()}function saveKnx(){config.knxArea=parseInt($("#knxArea").val().trim()),config.knxLine=parseInt($("#knxLine").val().trim()),config.knxMember=parseInt($("#knxMember").val().trim()),storeConfig()}function saveEmoncms(){config.emoncmsServer=$("#emoncmsServer").val().trim(),config.emoncmsPath=$("#emoncmsPath").val().trim(),config.emoncmsApikey=$("#emoncmsApikey").val().trim(),storeConfig()}function removeSwitch(e){const t=endpoint.baseUrl+"/remove-switch?id="+e;$.ajax({url:t,type:"DELETE",contentType:"text/plain; charset=utf-8",dataType:"json",success:function(e){fillSwitches(e)},error:function(){showMessage("Não foi possivel remvover a funcionalidade, por favor tenta novamente","Unable to remove this feature, please try again.")},timeout:2e3})}function removeSensor(e){const t=endpoint.baseUrl+"/remove-sensor?id="+e;$.ajax({url:t,type:"DELETE",contentType:"text/plain; charset=utf-8",dataType:"json",success:function(e){fillSensors(e)},error:function(){showMessage("Não foi possivel remvover a funcionalidade, por favor tenta novamente","Unable to remove this feature, please try again.")},timeout:2e3})}function reboot(){$.ajax({url:endpoint.baseUrl+"/reboot",contentType:"text/plain; charset=utf-8",dataType:"json",success:function(e){showMessage("O dispositivo está a reiniciar, ficará disponivel dentro de 10 segundos.","The device is restartin, will be available in 10 seconds.")},error:function(){showMessage("Não foi possivel reiniciar o dispositivo, verifica se está correctamente ligado à rede. Se o problema persistir tenta desligar da energia e voltar a ligar.","Unable to restart the device, check if it is connected to the correct network. If the problem persists try turning the power off.")},timeout:2e3})}function getLastVersion(e,t,o){$.ajax({url:"http://update.bhonofre.pt/firmware/latest-version?firmwareMode="+e+"&chipId="+o+"&currentVersion="+t,contentType:"text/plain; charset=utf-8",success:function(e){e<=t?$("#box-auto-update").addClass("hide"):($("#box-auto-update").removeClass("hide"),$("#lbl-lastversion").text(e))},error:function(){$("#box-auto-update").addClass("hide")},timeout:1e3})}function loadDefaults(){$.ajax({url:endpoint.baseUrl+"/load-defaults",contentType:"text/plain; charset=utf-8",dataType:"json",success:function(e){showMessage("Configuração de fábrica aplicada com sucesso. Por favor volte a ligar-se ao Access Point e aceda ao painel de controlo pelo endereço http://192.168.4.1 no seu browser.","Factory setting applied successfully. Please reconnect to Access Point and access the control panel at http://192.168.4.1 in your browser.")},error:function(){showMessage("Não foi possivel carregar a configuração de fábrica no dispositivo, verifica se está correctamente ligado à rede. Se o problema persistir tenta desligar da energia e voltar a ligar.","Unable to load factory configuration on the device, check if it is connected to the correct network. If the problem persists try turning the power off.")},timeout:1e3})}function systemStatus(){$.ajax({url:endpoint.baseUrl+"/system-status",contentType:"text/plain; charset=utf-8",dataType:"json",success:function(e){$("#ssid_lbl").text(e.wifiSSID),!document.getElementById("wifiIp")||0!==$('input[name="wifiIp"]').val().trim().length&&"(IP unset)"!==$('input[name="wifiIp"]').val()||($('input[name="wifiIp"]').val(e.wifiIp),$('input[name="wifiMask"]').val(e.wifiMask),$('input[name="wifiGw"]').val(e.wifiGw));let t=Math.min(2*(parseInt(e.signal)+100),100);config&&$("#mqtt_lbl").text(config.mqttIpDns),e.mqtt?$("#mqtt-state").text(showText("ligado","connected")):$("#mqtt-state").text(showText("desligado","disconnected")),$("#wifi-signal").text(t+"%")},error:function(){$("#wifi-signal").text("0%")},timeout:1e3})}$(document).ready(function(){let e=localStorage.getItem("lang");e?loadsLanguage(e):window.navigator.language.startsWith("en")?loadsLanguage("EN"):loadsLanguage("PT"),loadConfig(),$("#node_id").on("keypress",function(e){if(32===e.which)return!1}),$(".menu-item").click(function(e){toggleActive($(e.currentTarget).data("menu"))}),systemStatus(),toggleActive("node"),setInterval(systemStatus,15e3),window.EventSource&&(source=new EventSource(endpoint.baseUrl+"/events"))});